# ğŸ—ï¸ æ™ºèƒ½è¯¾ç¨‹åŠ©æ‰‹ - é¡¹ç›®æ¶æ„æ–‡æ¡£

## ğŸ“ å®Œæ•´æ–‡ä»¶ç»“æ„

```
deep-research-agents-v3/
â”‚
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒä»£ç æ–‡ä»¶ (6ä¸ª)
â”‚   â”œâ”€â”€ course_assistant.py          # ğŸ¯ ä¸»ç¨‹åºå…¥å£ï¼ˆLangGraph Server å¯¼å…¥æ­¤æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ course_tools.py               # ğŸ› ï¸ 7ä¸ªå·¥å…·å‡½æ•°ï¼ˆRAG + è®ºå› + æŠ¥å‘Šï¼‰
â”‚   â”œâ”€â”€ lightrag_client.py            # ğŸ”Œ LightRAG API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ state.py                      # ğŸ“Š çŠ¶æ€å®šä¹‰ï¼ˆKB Toggle + æ¨¡å¼ï¼‰v
â”‚   â”œâ”€â”€ course_subagents.json         # ğŸ¤– 4ä¸ªå­æ™ºèƒ½ä½“é…ç½®
â”‚   â””â”€â”€ course_instructions.md        # ğŸ“‹ ç³»ç»Ÿæç¤ºè¯ï¼ˆAgent è¡Œä¸ºè§„èŒƒï¼‰
â”‚
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶ (4ä¸ª)
â”‚   â”œâ”€â”€ langgraph.json                # âš™ï¸ LangGraph Server é…ç½®
â”‚   â”œâ”€â”€ requirements.txt              # ğŸ“¦ Python ä¾èµ–
â”‚   â”œâ”€â”€ .env.example                  # ğŸ”‘ ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â””â”€â”€ docker-compose.yml            # ğŸ³ LightRAG Docker é…ç½®
â”‚
â”œâ”€â”€ ğŸ“„ æ–‡æ¡£æ–‡ä»¶ (3ä¸ª)
â”‚   â”œâ”€â”€ README_COURSE_ASSISTANT.md    # ğŸ“– å®Œæ•´ä½¿ç”¨æ–‡æ¡£
â”‚   â”œâ”€â”€ PROJECT_MIGRATION_SUMMARY.md  # ğŸ“Š é¡¹ç›®æ”¹é€ æ€»ç»“
â”‚   â””â”€â”€ PROJECT_ARCHITECTURE.md       # ğŸ—ï¸ æœ¬æ–‡ä»¶ï¼ˆæ¶æ„è¯´æ˜ï¼‰
â”‚
â””â”€â”€ ğŸ“ æ•°æ®ç›®å½•ï¼ˆDocker æŒ‚è½½ï¼‰
    â”œâ”€â”€ data/rag_storage/             # LightRAG å‘é‡æ•°æ®åº“
    â””â”€â”€ data/inputs/                  # è¯¾ç¨‹ææ–™ï¼ˆPDF/PPTï¼‰
```

---

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### 1. `course_assistant.py` - ä¸»ç¨‹åºï¼ˆ135 è¡Œï¼‰

**ä½œç”¨**ï¼šAgent å®šä¹‰å’Œåˆå§‹åŒ–

**å…³é”®ä»£ç **ï¼š
```python
# åŠ è½½é…ç½®
with open("course_instructions.md") as f:
    SYSTEM_INSTRUCTIONS = f.read()

with open("course_subagents.json") as f:
    subagents_config = json.load(f)

# åˆ›å»º Deep Agentï¼ˆä¸€è¡Œä»£ç ï¼ï¼‰
course_agent = create_deep_agent(
    model=ChatAnthropic(...),
    tools=ALL_TOOLS,
    system_prompt=SYSTEM_INSTRUCTIONS,
    subagents=[knowledge_retriever, content_synthesizer, forum_composer, study_material_generator]
)

# å¯¼å‡ºï¼ˆLangGraph Server ä¼šå¯¼å…¥è¿™ä¸ªå˜é‡ï¼‰
agent = course_agent_with_memory
```

**LangGraph Server å¦‚ä½•ä½¿ç”¨**ï¼š
```json
// langgraph.json
{
  "graphs": {
    "course-assistant": "./course_assistant.py:agent"  // â† å¯¼å…¥è¿™ä¸ª agent å¯¹è±¡
  }
}
```

**å¯åŠ¨å‘½ä»¤**ï¼š
```bash
langgraph dev  # LangGraph Server è‡ªåŠ¨å¯¼å…¥å¹¶æš´éœ² API
```

---

### 2. `course_tools.py` - å·¥å…·å‡½æ•°ï¼ˆ230 è¡Œï¼‰

**ä½œç”¨**ï¼šå®šä¹‰ Agent å¯è°ƒç”¨çš„ 7 ä¸ªå·¥å…·

**å·¥å…·åˆ—è¡¨**ï¼š

#### RAG å·¥å…·ï¼ˆ3ä¸ªï¼‰

| å·¥å…·å | å‚æ•° | è¿”å› | ç”¨é€” |
|-------|------|------|------|
| `lightrag_query` | query, mode, include_references, only_need_context, ... | JSONï¼ˆanswer + context + sourcesï¼‰ | æ ¸å¿ƒæ£€ç´¢å·¥å…· |
| `get_lecture_content` | lecture_id, slide_range | JSONï¼ˆlecture content + citationï¼‰ | è·å–ç‰¹å®šè®²ä¹‰ |
| `search_exam_papers` | topic, year | JSONï¼ˆexam questions + sourcesï¼‰ | æœç´¢å†å¹´è¯•å· |

#### è®ºå›å·¥å…·ï¼ˆ2ä¸ªï¼‰

| å·¥å…·å | å‚æ•° | è¿”å› | ç”¨é€” |
|-------|------|------|------|
| `generate_forum_draft` | conversation_history | JSONï¼ˆå§”æ‰˜ç»™å­æ™ºèƒ½ä½“ï¼‰ | ç”Ÿæˆè®ºå›è‰ç¨¿ |
| `format_forum_post` | draft | Markdown | æ ¼å¼åŒ–å¸–å­ |

#### æŠ¥å‘Šå·¥å…·ï¼ˆ2ä¸ªï¼‰

| å·¥å…·å | å‚æ•° | è¿”å› | ç”¨é€” |
|-------|------|------|------|
| `generate_study_report` | topic, lectures, include_examples | JSONï¼ˆå§”æ‰˜ç»™å­æ™ºèƒ½ä½“ï¼‰ | ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š |
| `create_cheat_sheet` | concept | JSONï¼ˆcontent + sourcesï¼‰ | åˆ›å»ºé€ŸæŸ¥è¡¨ |

**å…³é”®ä»£ç ç¤ºä¾‹**ï¼š
```python
@tool
def lightrag_query(query: str, mode: str = "mix", only_need_context: bool = False, include_references: bool = True) -> str:
    """æŸ¥è¯¢ LightRAG çŸ¥è¯†åº“"""
    result = lightrag.query(
        query=query,
        mode=mode,
        include_references=include_references,
        only_need_context=only_need_context,
    )
    return json.dumps({
        "response": result.get("response"),
        "references": result.get("references"),
        "sources": result.get("sources")  # â† åŒ…å«å¼•ç”¨ä¿¡æ¯
    })
```

---

### 3. `lightrag_client.py` - LightRAG å®¢æˆ·ç«¯ï¼ˆ180 è¡Œï¼‰

**ä½œç”¨**ï¼šå°è£… LightRAG API è°ƒç”¨

**æ ¸å¿ƒç±»**ï¼š
```python
class LightRAGClient:
    def __init__(self, base_url="http://localhost:9621"):
        self.base_url = base_url

    def query(self, query: str, mode: str = "hybrid") -> Dict:
        """æŸ¥è¯¢ LightRAG"""
        # TODO: éœ€è¦æ ¹æ®å®é™… API è°ƒæ•´
        response = requests.post(f"{self.base_url}/query", json={...})
        return self._parse_result(response.json())

    def _parse_result(self, result: Dict) -> Dict:
        """è§£æè¿”å›ç»“æœï¼Œæå–æ¥æºä¿¡æ¯"""
        # TODO: æ ¹æ®å®é™…è¿”å›æ ¼å¼è°ƒæ•´
        return {
            "answer": result.get("answer"),
            "context": result.get("context"),
            "sources": self._extract_source_info(result)
        }

    def _extract_source_info(self, metadata: Dict) -> List[Dict]:
        """æå–æ¥æºä¿¡æ¯ï¼ˆè®²ä¹‰ç¼–å·ã€é¡µç ç­‰ï¼‰"""
        # TODO: æ ¹æ®å®é™…å…ƒæ•°æ®æ ¼å¼è°ƒæ•´
        pass
```

**é‡è¦**ï¼šæ­¤æ–‡ä»¶æ˜¯å ä½ç¬¦ï¼Œéœ€è¦æ ¹æ®ä½ çš„ LightRAG API è°ƒæ•´ï¼

---

### 4. `state.py` - çŠ¶æ€å®šä¹‰ï¼ˆ50 è¡Œï¼‰

**ä½œç”¨**ï¼šå®šä¹‰ Agent çš„çŠ¶æ€ç»“æ„

**æ ¸å¿ƒçŠ¶æ€**ï¼š
```python
class CourseAssistantState(TypedDict):
    # æ¶ˆæ¯å†å²ï¼ˆè‡ªåŠ¨è¿½åŠ ï¼‰
    messages: Annotated[List[BaseMessage], add_messages]

    # â­ KB å¼€å…³ï¼ˆæ ¸å¿ƒï¼ï¼‰
    kb_enabled: bool  # True = KB ON, False = KB OFF

    # â­ å½“å‰æ¨¡å¼
    current_mode: Literal["qa", "forum", "report"]

    # æ£€ç´¢ç»“æœç¼“å­˜
    retrieved_documents: List[Dict[str, Any]]

    # å¼•ç”¨ä¿¡æ¯
    citations: List[Dict[str, Any]]

    # å¯¹è¯æ‘˜è¦ï¼ˆç”¨äºè®ºå›ç”Ÿæˆï¼‰
    conversation_summary: str

    # ç”¨æˆ·åå¥½
    user_preferences: Dict[str, Any]
```

**KB Toggle ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
# å‰ç«¯ä¼ é€’çŠ¶æ€
{
  "messages": [...],
  "kb_enabled": True,  # â† KB å¼€å…³
  "current_mode": "qa"
}

# Agent æ£€æŸ¥çŠ¶æ€
if state["kb_enabled"] == True:
    # è°ƒç”¨ RAG å·¥å…·
    lightrag_query(...)
else:
    # çº¯ LLM æ¨ç†
```

---

### 5. `course_subagents.json` - å­æ™ºèƒ½ä½“é…ç½®ï¼ˆ330 è¡Œï¼‰

**ä½œç”¨**ï¼šå®šä¹‰ 4 ä¸ªä¸“ä¸šåŒ–å­æ™ºèƒ½ä½“

**é…ç½®ç»“æ„**ï¼š
```json
{
  "subagent_name": {
    "name": "unique-name",           // å”¯ä¸€æ ‡è¯†ç¬¦
    "description": "ç®€çŸ­æè¿°",       // ä¸» Agent çœ‹åˆ°çš„æè¿°
    "prompt": "è¯¦ç»†ç³»ç»Ÿæç¤ºè¯",      // å­æ™ºèƒ½ä½“çš„è¡Œä¸ºè§„èŒƒ
    "tools": ["tool1", "tool2"]      // å¯ç”¨å·¥å…·åˆ—è¡¨
  }
}
```

**4 ä¸ªå­æ™ºèƒ½ä½“**ï¼š

| å­æ™ºèƒ½ä½“ | èŒè´£ | å¯ç”¨å·¥å…· | è¾“å‡º |
|---------|------|---------|------|
| **Knowledge Retriever** | æ£€ç´¢è¯¾ç¨‹ææ–™ | lightrag_query, get_lecture_content, search_exam_papers | æ£€ç´¢ç»“æœ + æ¥æº |
| **Content Synthesizer** | ç»¼åˆç”Ÿæˆç­”æ¡ˆ | æ— ï¼ˆåªç»¼åˆï¼‰ | å¸¦å¼•ç”¨çš„ç­”æ¡ˆ |
| **Forum Composer** | ç”Ÿæˆè®ºå›å¸–å­ | generate_forum_draft, format_forum_post | Markdown å¸–å­ |
| **Cheat Sheet Generator** | ç”Ÿæˆé€ŸæŸ¥è¡¨ | lightrag_query, create_cheat_sheet | HTML é€ŸæŸ¥å¡ |
| **Study Material Generator** | ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š | lightrag_query, generate_study_report | ç»“æ„åŒ–æŠ¥å‘Š |

**è°ƒç”¨æ–¹å¼**ï¼š
```python
# ä¸» Agent è‡ªåŠ¨å¯ä»¥ä½¿ç”¨ task() å·¥å…·
task(
    subagent_name="knowledge-retriever",
    task_description="æ£€ç´¢å…³äº RAG æ¶æ„çš„å†…å®¹"
)
```

---

### 6. `course_instructions.md` - ç³»ç»Ÿæç¤ºè¯ï¼ˆ450 è¡Œï¼‰

**ä½œç”¨**ï¼šå®šä¹‰ä¸» Agent çš„è¡Œä¸ºè§„èŒƒ

**æ ¸å¿ƒå†…å®¹**ï¼š

1. **KB Toggle æ£€æŸ¥é€»è¾‘**ï¼ˆæœ€é‡è¦ï¼ï¼‰
   ```markdown
   ALWAYS check the `kb_enabled` state at the start of EVERY response.

   if state["kb_enabled"] == True:
       # KB ON: Use RAG tools, provide citations
   else:
       # KB OFF: Pure LLM reasoning, add disclaimer
   ```

2. **ä¸‰ç§æ¨¡å¼çš„å·¥ä½œæµç¨‹**
   - Mode 1: çŸ¥è¯†é—®ç­”ï¼ˆqaï¼‰
   - Mode 2: è®ºå›å¸–å­ç”Ÿæˆï¼ˆforumï¼‰
   - Mode 3: å­¦ä¹ æŠ¥å‘Šç”Ÿæˆï¼ˆreportï¼‰

3. **è¾“å‡ºæ ¼å¼è§„èŒƒ**
   - Tool calls â†’ JSON only
   - Final answers â†’ Markdown with citations
   - KB ON â†’ Must include `[1] æ•°æ®æŒ–æ˜ ç¬¬8è®²ï¼Œå¹»ç¯ç‰‡26-27`
   - KB OFF â†’ Must include disclaimer

4. **é”™è¯¯å¤„ç†ç­–ç•¥**
   - No relevant material found
   - LightRAG connection error
   - Ambiguous query
   - Out-of-scope question

---

## ğŸ“„ é…ç½®æ–‡ä»¶è¯¦è§£

### `langgraph.json` - LangGraph é…ç½®

```json
{
  "dependencies": ["."],
  "graphs": {
    "course-assistant": "./course_assistant.py:agent"  // â† å¯¼å…¥è·¯å¾„
  },
  "env": ".env"
}
```

**LangGraph Server å¯åŠ¨æµç¨‹**ï¼š
```bash
langgraph dev

# 1. è¯»å– langgraph.json
# 2. å¯¼å…¥ course_assistant.py çš„ agent å¯¹è±¡
# 3. åˆ›å»º REST API ç«¯ç‚¹ï¼š
#    - POST /invoke (å•æ¬¡è°ƒç”¨)
#    - POST /stream (æµå¼è°ƒç”¨)
#    - GET /threads/{id} (è·å–ä¼šè¯)
# 4. ç›‘å¬ http://localhost:2024
```

### `requirements.txt` - Python ä¾èµ–

**æ ¸å¿ƒä¾èµ–**ï¼š
```
langchain==0.3.27
langgraph==0.6.10
deepagents==0.2.6           # â† DeepAgents æ¡†æ¶
langchain-anthropic==0.3.30  # â† Claude API
python-dotenv==1.0.0
requests==2.31.0
```

### `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿

```env
# å¿…éœ€
ANTHROPIC_API_KEY=your_api_key_here

# LightRAG é…ç½®
LIGHTRAG_BASE_URL=http://localhost:9621

# å¯é€‰
CLAUDE_MODEL=claude-sonnet-4-20250514
RECURSION_LIMIT=30
```

---

## ğŸ”„ æ•°æ®æµæ¶æ„

### å®Œæ•´è¯·æ±‚æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: ç”¨æˆ·è¾“å…¥                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ç”¨æˆ·åœ¨ Deep Agents UI è¾“å…¥: "ä»€ä¹ˆæ˜¯ RAG æ¶æ„ï¼Ÿ"              â”‚
â”‚  KB Toggle: ON                                              â”‚
â”‚  Mode: qa                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP POST
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: å‰ç«¯å‘é€è¯·æ±‚åˆ° LangGraph Server                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  POST http://localhost:2024/invoke                          â”‚
â”‚  {                                                           â”‚
â”‚    "messages": [{"role": "user", "content": "ä»€ä¹ˆæ˜¯RAG?"}],  â”‚
â”‚    "kb_enabled": true,      â† KB å¼€å…³                        â”‚
â”‚    "current_mode": "qa",    â† å½“å‰æ¨¡å¼                       â”‚
â”‚    "retrieved_documents": [],                               â”‚
â”‚    "citations": [],                                         â”‚
â”‚    "conversation_summary": "",                              â”‚
â”‚    "user_preferences": {}                                   â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: LangGraph Server è°ƒç”¨ Course Assistant Agent       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  agent.invoke(state, config={"thread_id": "..."})           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: Main Agent æ‰§è¡Œï¼ˆæ ¹æ® instructions.mdï¼‰             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  1. æ£€æŸ¥ kb_enabled = True â†’ èµ° RAG è·¯å¾„                     â”‚
â”‚  2. æ£€æŸ¥ current_mode = "qa" â†’ çŸ¥è¯†é—®ç­”æ¨¡å¼                  â”‚
â”‚  3. å†³å®šå§”æ‰˜ç»™å­æ™ºèƒ½ä½“                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: å§”æ‰˜ Knowledge Retriever SubAgent                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  task(                                                       â”‚
â”‚    subagent_name="knowledge-retriever",                     â”‚
â”‚    task_description="æ£€ç´¢å…³äº RAG æ¶æ„çš„å†…å®¹"                 â”‚
â”‚  )                                                           â”‚
â”‚                                                              â”‚
â”‚  Knowledge Retriever æ‰§è¡Œ:                                   â”‚
â”‚  â†’ è°ƒç”¨ lightrag_query("RAGæ¶æ„", mode="hybrid")             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: LightRAG æŸ¥è¯¢ï¼ˆlightrag_client.pyï¼‰                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  POST http://localhost:9621/query                           â”‚
â”‚  {                                                           â”‚
â”‚    "query": "RAGæ¶æ„",                                       â”‚
â”‚    "mode": "hybrid"                                         â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  LightRAG è¿”å›:                                              â”‚
â”‚  {                                                           â”‚
â”‚    "answer": "RAGåŒ…å«ä¸‰ä¸ªç»„ä»¶...",                           â”‚
â”‚    "context": [...],                                        â”‚
â”‚    "metadata": {                                            â”‚
â”‚      "source_type": "lecture",                              â”‚
â”‚      "lecture_id": 8,                                       â”‚
â”‚      "slide_range": "26-27"                                 â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 7: Knowledge Retriever è¿”å›ç»“æœ                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  {                                                           â”‚
â”‚    "retrieved_content": "RAGåŒ…å«ä¸‰ä¸ªç»„ä»¶...",                â”‚
â”‚    "sources": [                                             â”‚
â”‚      {                                                       â”‚
â”‚        "type": "lecture",                                   â”‚
â”‚        "lecture_id": 8,                                     â”‚
â”‚        "slide_range": "26-27",                              â”‚
â”‚        "citation": "æ•°æ®æŒ–æ˜ ç¬¬8è®²ï¼Œå¹»ç¯ç‰‡26-27"             â”‚
â”‚      }                                                       â”‚
â”‚    ]                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 8: å§”æ‰˜ Content Synthesizer SubAgent                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  task(                                                       â”‚
â”‚    subagent_name="content-synthesizer",                     â”‚
â”‚    task_description="ç»¼åˆæ£€ç´¢ç»“æœï¼Œç”Ÿæˆå¸¦å¼•ç”¨çš„ç­”æ¡ˆ"          â”‚
â”‚  )                                                           â”‚
â”‚                                                              â”‚
â”‚  Content Synthesizer æ‰§è¡Œ:                                   â”‚
â”‚  â†’ ä¸è°ƒç”¨å·¥å…·ï¼Œåªæ•´åˆä¿¡æ¯                                     â”‚
â”‚  â†’ ç”Ÿæˆç»“æ„åŒ–ç­”æ¡ˆ + æ·»åŠ å¼•ç”¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 9: Main Agent è¿”å›æœ€ç»ˆç­”æ¡ˆ                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  {                                                           â”‚
â”‚    "messages": [                                            â”‚
â”‚      ...,                                                    â”‚
â”‚      {                                                       â”‚
â”‚        "role": "assistant",                                 â”‚
â”‚        "content": "RAGæ¶æ„åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶[1]...           â”‚
â”‚                                                              â”‚
â”‚                    **å¼•ç”¨**:                                 â”‚
â”‚                    [1] æ•°æ®æŒ–æ˜ ç¬¬8è®²ï¼Œå¹»ç¯ç‰‡26-27"         â”‚
â”‚      }                                                       â”‚
â”‚    ]                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 10: å‰ç«¯æ˜¾ç¤ºç­”æ¡ˆ                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ç”¨æˆ·çœ‹åˆ°å¸¦å¼•ç”¨çš„ç­”æ¡ˆ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ LightRAG API é›†æˆç‚¹

**éœ€è¦è°ƒæ•´çš„æ–‡ä»¶**ï¼š`lightrag_client.py`

**éœ€è¦è°ƒæ•´çš„å‡½æ•°**ï¼š

1. **`query()`** - ç¬¬ 35-80 è¡Œ
   ```python
   def query(self, query: str, mode: str) -> Dict:
       # TODO: æ ¹æ®å®é™… API è°ƒæ•´è¯·æ±‚æ ¼å¼
       response = requests.post(...)
       return self._parse_result(response.json())
   ```

2. **`_parse_result()`** - ç¬¬ 82-100 è¡Œ
   ```python
   def _parse_result(self, result: Dict) -> Dict:
       # TODO: æ ¹æ®å®é™…è¿”å›æ ¼å¼è°ƒæ•´è§£æé€»è¾‘
       return {
           "answer": ...,
           "context": ...,
           "sources": ...
       }
   ```

3. **`_extract_source_info()`** - ç¬¬ 102-135 è¡Œ
   ```python
   def _extract_source_info(self, metadata: Dict) -> Dict:
       # TODO: æ ¹æ®å®é™…å…ƒæ•°æ®æ ¼å¼æå–æ¥æºä¿¡æ¯
       return {
           "lecture_id": ...,
           "slide_range": ...,
           "citation": "æ•°æ®æŒ–æ˜ ç¬¬Xè®²ï¼Œå¹»ç¯ç‰‡Y-Z"
       }
   ```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæ–‡ä»¶ä¾èµ–å…³ç³»

```
course_assistant.py (ä¸»ç¨‹åº)
    â”œâ”€â”€ course_instructions.md (ç³»ç»Ÿæç¤ºè¯)
    â”œâ”€â”€ course_subagents.json (å­æ™ºèƒ½ä½“é…ç½®)
    â”œâ”€â”€ course_tools.py (å·¥å…·å‡½æ•°)
    â”‚   â””â”€â”€ lightrag_client.py (LightRAG å®¢æˆ·ç«¯)
    â””â”€â”€ state.py (çŠ¶æ€å®šä¹‰)
```

### æ–‡ä»¶ç±»å‹ç»Ÿè®¡

- æ ¸å¿ƒä»£ç ï¼š6 ä¸ªæ–‡ä»¶ï¼ˆ.py, .json, .mdï¼‰
- é…ç½®æ–‡ä»¶ï¼š4 ä¸ªæ–‡ä»¶
- æ–‡æ¡£æ–‡ä»¶ï¼š3 ä¸ªæ–‡ä»¶
- **æ€»è®¡**ï¼š13 ä¸ªæ–‡ä»¶

### ä»£ç è¡Œæ•°ç»Ÿè®¡

- `course_assistant.py`: ~135 è¡Œ
- `course_tools.py`: ~230 è¡Œ
- `lightrag_client.py`: ~180 è¡Œ
- `state.py`: ~50 è¡Œ
- `course_subagents.json`: ~330 è¡Œ
- `course_instructions.md`: ~450 è¡Œ
- **æ€»è®¡**: ~1375 è¡Œ

---

**ä¸‹ä¸€æ­¥**ï¼šæä¾› LightRAG API æ–‡æ¡£ï¼Œæˆ‘ä¼šå®Œå–„ `lightrag_client.py` çš„é›†æˆï¼
